<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="951" height="908"><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="951" height="908"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="336.4167899247265" y="22.6179738" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">PKI-AUTH: Authentication</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 285.4410899741406 88.511670804 L 285.4410899741406 908.790187284" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 709.7008089671093 88.511670804 L 709.7008089671093 908.790187284" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 248.92242276743357 47.799317964000004 L 321.95975718084765 47.799317964000004 L 321.95975718084765 88.511670804 L 248.92242276743357 88.511670804 L 248.92242276743357 47.799317964000004 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="265.28275714943356" y="73.43302160400002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">client</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 670.1071409974628 47.799317964000004 L 749.2944769367558 47.799317964000004 L 749.2944769367558 88.511670804 L 670.1071409974628 88.511670804 L 670.1071409974628 47.799317964000004 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="686.4674753794628" y="73.43302160400002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">server</text></g></g><g><g><g><rect fill="white" stroke="none" x="420.8008207917968" y="118.668969204" width="153.54025735765626" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="423.0626181717968" y="132.239753484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Requests login page</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 285.4410899741406 138.27121316400002 L 707.1877007671093 138.27121316400002" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(709.7008089671093,138.27121316400002) translate(-709.7008089671093,-138.27121316400002)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 697.1352679671093 131.98844266400002 L 709.7008089671093 138.27121316400002 L 697.1352679671093 144.55398366400001 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 522.7490405412109 160.889186964 L 883.0817931130077 160.889186964 L 896.6525773930077 174.459971244 L 896.6525773930077 210.64872932400002 L 522.7490405412109 210.64872932400002 L 522.7490405412109 160.889186964 M 883.0817931130077 160.889186964 L 883.0817931130077 174.459971244 L 896.6525773930077 174.459971244" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="543.8591494212109" y="181.99929584400002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Generated a challenge = uuid()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="543.8591494212109" y="197.07794504400002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. JWTChallenge = sign(challenge, jwtSecret)</text></g><g><g><rect fill="white" stroke="none" x="331.5258116365234" y="233.26670312400003" width="187.7235917082422" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="331.5258116365234" y="248.34535232400003" width="332.0902756682031" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="333.7876090165234" y="246.83748740400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Login page with QR code</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="333.7876090165234" y="261.91613660400003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Params: {JWTChallenge, challenge, domain}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 709.7008089671093 267.94759628400004 L 287.9541981741406 267.94759628400004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(285.4410899741406,267.94759628400004) translate(-285.4410899741406,-267.94759628400004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 298.0066309741406 261.664825784 L 285.4410899741406 267.94759628400004 L 298.0066309741406 274.23036678400007 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 7.5393246000000005 290.56557008400006 L 549.7720710682812 290.56557008400006 L 563.3428553482812 304.13635436400006 L 563.3428553482812 491.1116044440001 L 7.5393246000000005 491.1116044440001 L 7.5393246000000005 290.56557008400006 M 549.7720710682812 290.56557008400006 L 549.7720710682812 304.13635436400006 L 563.3428553482812 304.13635436400006" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="311.6756789640001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Client either uses his user agent</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="326.75432816400007" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">to scan the QR code and signs the</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="341.83297736400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">userDoc using crypto material </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="255.41609607765622" y="341.83297736400004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">OR</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="356.911626564" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"></text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="371.990275764" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Upload both these documents and presses</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="387.06892496399996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">the </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="57.39943347999997" y="387.06892496399996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Sign</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="93.94943271706052" y="387.06892496399996" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> button to attach the proof, the signedDoc(LDS).</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="402.14757416399993" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"></text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="417.2262233639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">signedDoc = sign(userDoc, privateKey, publicKey, challenge, domain)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="432.3048725639999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"></text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="447.38352176399985" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">User can also view the attached signature.</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="462.4621709639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Once the proof is attached to </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="248.4994395835156" y="462.4621709639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">userDoc</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="315.83277545998044" y="462.4621709639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">, user</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="28.64943347999997" y="477.5408201639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">presses </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="89.36610065529294" y="477.5408201639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Login</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="134.78276859352536" y="477.5408201639998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> button. </text></g><g><g><rect fill="white" stroke="none" x="303.28415819414056" y="513.7295782440001" width="113.35693063646484" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="303.28415819414056" y="528.8082274440001" width="388.57358255296873" height="19.602243960000003"/></g><g><rect fill="white" stroke="none" x="303.28415819414056" y="543.886876644" width="298.3069199553125" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="305.5459555741406" y="527.3003625240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Login Request;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="305.5459555741406" y="542.3790117240001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Params: {SignedDoc: {userData, proof}, publicKey}</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="305.5459555741406" y="557.457660924" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Headers: ['x-auth-token': JWTChallenge]</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 285.4410899741406 563.489120604 L 707.1877007671093 563.489120604" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(709.7008089671093,563.489120604) translate(-709.7008089671093,-563.489120604)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 697.1352679671093 557.2063501040001 L 709.7008089671093 563.489120604 L 697.1352679671093 569.771891104 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 475.3573626847656 586.1070944040001 L 930.473470969453 586.1070944040001 L 944.044255249453 599.6778786840001 L 944.044255249453 635.8666367640001 L 475.3573626847656 635.8666367640001 L 475.3573626847656 586.1070944040001 M 930.473470969453 586.1070944040001 L 930.473470969453 599.6778786840001 L 944.044255249453 599.6778786840001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="496.46747156476556" y="607.217203284" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Extract 'x-auth-token' header</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="496.46747156476556" y="622.295852484" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Verify JWT; challenge = verify(JWTChallenge, jwtSecret)</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 482.1323651643188 658.484610564 L 923.6984684898998 658.484610564 L 937.2692527698998 672.055394844 L 937.2692527698998 813.794697324 L 482.1323651643188 813.794697324 L 482.1323651643188 658.484610564 M 923.6984684898998 658.484610564 L 923.6984684898998 672.055394844 L 937.2692527698998 672.055394844" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="503.2424740443188" y="679.594719444" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Checks if the publicKey exists in db?</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="503.2424740443188" y="694.673368644" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Verify the attached proof; </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="503.2424740443188" y="709.752017844" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"></text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="503.2424740443188" y="724.8306670439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    verify(SignedDoc, publicKey,domain, challenge)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="503.2424740443188" y="739.9093162439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"></text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="503.2424740443188" y="754.9879654439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Extract the </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="607.8591427454907" y="754.9879654439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">userData</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="683.2258114466625" y="754.9879654439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> from signedDoc</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="503.2424740443188" y="770.0666146439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">4. Generate </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="595.1091427454907" y="770.0666146439999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">sha3(userData)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="503.2424740443188" y="785.1452638439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">5. Checks if the hash in db == generated hash</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="503.2424740443188" y="800.2239130439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">6. Generates </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="602.7591442713696" y="800.2239130439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">JWT</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="634.4091438898998" y="800.2239130439998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> with: JWT = sign(userData, jwtSecret)</text></g><g><g><rect fill="white" stroke="none" x="341.73415514238275" y="836.412671124" width="311.67358865648436" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="343.99595252238277" y="849.983455404" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Login response; Params: {JWT, userData}</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 709.7008089671093 856.014915084 L 287.9541981741406 856.014915084" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="6.03145968"/><g transform="translate(285.4410899741406,856.014915084) translate(-285.4410899741406,-856.014915084)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 298.0066309741406 849.732144584 L 285.4410899741406 856.014915084 L 298.0066309741406 862.297685584 Z"/></g></g></g><g/><g/></g></svg>